---
phase: 02-collection-agents
plan: 04
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/integrations/rss.py
  - src/agents/news_agent.py
  - tests/test_rss_normalization.py
autonomous: true
must_haves:
  truths:
    - "News Agent can pull items from a built-in RSS feed list (optional override via env var)"
    - "RSS items normalize into UnifiedThreat with useful content_text"
  artifacts:
    - path: "src/integrations/rss.py"
      provides: "RSS fetch + parsing into raw items"
    - path: "src/agents/news_agent.py"
      provides: "News collector agent (RSS -> UnifiedThreat -> storage)"
  key_links:
    - from: "src/agents/news_agent.py"
      to: "src/integrations/rss.py"
      via: "fetch_feed"
      pattern: "fetch_feed"
---

<objective>
Implement the News Agent to collect from security RSS feeds and normalize into the unified threat model.

Purpose: Provide narrative context and active breach/exploit mentions to correlate with CVEs and indicators.
Output: RSS integration client, News agent, tests.
</objective>

<execution_context>
@/home/ubuntu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
  @.planning/REQUIREMENTS.md
  @.planning/phases/02-collection-agents/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add RSS integration client</name>
  <files>src/integrations/rss.py</files>
  <action>
Create `src/integrations/rss.py` using `feedparser`:
- `fetch_feed(url: str) -> list[dict]` returning raw-ish items (title, link, summary, published)

Be defensive:
- tolerate missing published/summary
- normalize dates to ISO strings or datetimes at the normalization layer
  </action>
  <verify>python3 -c "from integrations.rss import fetch_feed"</verify>
  <done>RSS integration imports</done>
</task>

<task type="auto">
  <name>Task 2: Implement News Agent (collect -> normalize -> store)</name>
  <files>src/agents/news_agent.py</files>
  <action>
Create `src/agents/news_agent.py` with `run_news_collection()`:
- Use a small, built-in `DEFAULT_FEEDS` list inside the agent (keep it short and security-focused)
- Optional override: if `RSS_FEED_URLS` env var is set (comma-separated), use that instead
- Fetch items per feed
- Normalize via `normalize_rss_item`
- Upsert into Cosmos

Return stats: {feeds, fetched, normalized, stored, errors}.
  </action>
  <verify>python3 -c "from agents.news_agent import run_news_collection"</verify>
  <done>News agent entrypoint is importable</done>
</task>

<task type="auto">
  <name>Task 3: Add RSS normalization tests</name>
  <files>tests/test_rss_normalization.py</files>
  <action>
Add a minimal RSS item payload fixture and assert:
- stable id prefix (e.g., `rss:`)
- content_text contains title + summary
  </action>
  <verify>python3 -m pytest -q</verify>
  <done>RSS tests pass</done>
</task>

</tasks>

<verification>
- `python3 -m pytest -q` passes
</verification>

<success_criteria>
- News Agent can populate Cosmos with RSS-derived `UnifiedThreat` documents
</success_criteria>

<output>
After completion, create `.planning/phases/02-collection-agents/02-04-SUMMARY.md`
</output>
