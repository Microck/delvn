---
phase: 04-prioritization-reporting
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - src/config/user_stack.yaml
  - src/config/user_stack.py
  - tests/test_user_stack.py
autonomous: true
must_haves:
  truths:
    - "User can declare their tech stack in a simple YAML file"
    - "Config is validated and loaded into a typed structure"
  artifacts:
    - path: "src/config/user_stack.yaml"
      provides: "Demo-ready user tech stack configuration"
    - path: "src/config/user_stack.py"
      provides: "Loader + validation for user stack"
  key_links:
    - from: "src/config/user_stack.py"
      to: "src/agents/prioritizer_agent.py"
      via: "typed stack object"
      pattern: "UserStack"
---

<objective>
Add user tech stack configuration and validation.

Purpose: Personalize prioritization so the same threat feed becomes relevant to a specific environment.
Output: user_stack.yaml + loader.
</objective>

<execution_context>
@/home/ubuntu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/REQUIREMENTS.md
@.planning/ROADMAP.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create user stack YAML format + sample</name>
  <files>
pyproject.toml
src/config/user_stack.yaml
  </files>
  <action>
Add `pyyaml` to `pyproject.toml` dependencies if it's not already present (required to load YAML config).

Create `src/config/user_stack.yaml` with a simple shape:
- `products`: list of strings (e.g., "Apache HTTP Server", "PostgreSQL", "React")
- `platforms`: list of strings (e.g., "linux")
- `exclude`: list of strings (e.g., "windows")
- `keywords`: list of strings (extra match terms)

Ensure it includes the demo scenario stack: Apache, PostgreSQL, React.
  </action>
  <verify>python3 -m pip install -e . && python3 -c "import pathlib, yaml; yaml.safe_load(pathlib.Path('src/config/user_stack.yaml').read_text())"</verify>
  <done>PyYAML parses the sample user stack config</done>
</task>

<task type="auto">
  <name>Task 2: Implement typed loader + validation</name>
  <files>src/config/user_stack.py</files>
  <action>
Create `src/config/user_stack.py`:
- `UserStack` Pydantic model with lists defaulting to []
- `load_user_stack(path: str = 'src/config/user_stack.yaml') -> UserStack`

Validation:
- dedupe + lowercase for matching, but preserve original display strings
  </action>
  <verify>python3 -c "from config.user_stack import load_user_stack; print(load_user_stack())"</verify>
  <done>User stack loads into a typed object</done>
</task>

<task type="auto">
  <name>Task 3: Add tests for loader + normalization rules</name>
  <files>tests/test_user_stack.py</files>
  <action>
Add tests:
- missing fields default to []
- case normalization results are predictable
  </action>
  <verify>python3 -m pytest -q</verify>
  <done>User stack tests pass</done>
</task>

</tasks>

<verification>
- `python3 -m pytest -q` passes
</verification>

<success_criteria>
- User stack config can be used as the only input for relevance scoring
</success_criteria>

<output>
After completion, create `.planning/phases/04-prioritization-reporting/04-01-SUMMARY.md`
</output>
