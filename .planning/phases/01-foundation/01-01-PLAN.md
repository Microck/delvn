---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - src/common/__init__.py
  - src/common/http.py
  - src/config/__init__.py
  - src/config/settings.py
  - tests/test_settings_smoke.py
autonomous: true
must_haves:
  truths:
    - "Project installs and basic imports work (settings + HTTP helpers)"
    - "Runtime config is typed and loaded from environment (.env optional)"
  artifacts:
    - path: "pyproject.toml"
      provides: "Python project + dependency manifest"
    - path: "src/config/settings.py"
      provides: "Typed settings surface (Azure + APIs)"
    - path: "src/common/http.py"
      provides: "Shared HTTP client helpers for agents"
    - path: "tests/test_settings_smoke.py"
      provides: "Minimal smoke test for imports"
  key_links:
    - from: "src/config/settings.py"
      to: "process environment"
      via: "pydantic-settings BaseSettings"
      pattern: "BaseSettings"
    - from: "src/common/http.py"
      to: "external APIs"
      via: "httpx client"
      pattern: "httpx"
---

<objective>
Create the Python project scaffold and a minimal, typed configuration layer used by all later agents.

Purpose: Establish a stable base (deps, settings, HTTP) so later plans can focus on behavior.
Output: Installable project, settings module, shared HTTP utilities.
</objective>

<execution_context>
@/home/ubuntu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Python project config (pyproject + test runner)</name>
  <files>pyproject.toml</files>
  <action>
Create `pyproject.toml` using a simple setuptools-based `src/` layout.

Dependencies (minimum): `pydantic`, `pydantic-settings`, `httpx`, `tenacity`, `feedparser`, `python-dateutil`, `pyyaml`, `azure-cosmos`, `azure-search-documents`, `azure-identity`, `pytest`.

Keep it boring:
- No pre-commit, no formatting tools unless already required.
- Configure pytest to discover `tests/`.
  </action>
  <verify>python3 -m pip install -e . && python3 -m pytest -q</verify>
  <done>`python3 -m pytest -q` runs (even if only smoke tests exist)</done>
</task>

<task type="auto">
  <name>Task 2: Implement typed settings for Azure + APIs</name>
  <files>
src/config/__init__.py
src/config/settings.py
  </files>
  <action>
Create `src/config/settings.py` using `pydantic_settings.BaseSettings`.

Include (as strings unless otherwise needed):
- `APP_ENV` (default: "dev"), `LOG_LEVEL` (default: "INFO")
- Cosmos: `COSMOS_ENDPOINT`, `COSMOS_KEY`, `COSMOS_DATABASE` (default: "delvn"), `COSMOS_CONTAINER_THREATS` (default: "threats"), `COSMOS_CONTAINER_CORRELATIONS` (default: "correlations")
- AI Search: `SEARCH_ENDPOINT`, `SEARCH_KEY`, `SEARCH_INDEX_THREATS` (default: "threats")
- Embeddings: `EMBEDDING_DIM` (int, default: 1536)
- NVD: `NVD_API_KEY` (optional)
- OTX: `OTX_API_KEY` (optional)
 - Foundry: `FOUNDRY_ENDPOINT` (optional), `FOUNDRY_API_KEY` (optional)
 - Azure OpenAI (embeddings): `AZURE_OPENAI_ENDPOINT` (optional), `AZURE_OPENAI_API_KEY` (optional), `AZURE_OPENAI_EMBEDDING_DEPLOYMENT` (optional), `AZURE_OPENAI_API_VERSION` (optional)

Provide a single `Settings` class and a helper `get_settings()` that memoizes a singleton.
  </action>
  <verify>python3 -c "from config.settings import Settings; Settings()"</verify>
  <done>`Settings()` constructs without requiring any secrets in dev mode</done>
</task>

<task type="auto">
  <name>Task 3: Add shared HTTP helpers with retries</name>
  <files>
src/common/__init__.py
src/common/http.py
tests/test_settings_smoke.py
  </files>
  <action>
Create `src/common/http.py`:
- Build an `httpx.Client` with sane defaults (timeouts, user-agent).
- Provide `get_json(url, *, headers=None, params=None)` helper.
- Add retry/backoff for transient errors (429/5xx, connection/timeouts) using `tenacity`.

Add `tests/test_settings_smoke.py` to smoke-import `config.settings` and `common.http`.
  </action>
  <verify>python3 -m pytest -q</verify>
  <done>Smoke test passes; helpers are importable</done>
</task>

</tasks>

<verification>
- `python3 -m pip install -e .` succeeds
- `python3 -m pytest -q` passes
</verification>

<success_criteria>
- Settings + HTTP helpers exist and are used as the single source of config/client defaults in later plans
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
