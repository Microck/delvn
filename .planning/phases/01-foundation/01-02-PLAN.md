---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/models/__init__.py
  - src/models/threat.py
  - tests/test_threat_model.py
autonomous: true
must_haves:
  truths:
    - "Threat objects validate consistently (CVE, indicator, campaign)"
    - "Every stored threat has a stable ID, source, type, timestamps, and raw payload"
  artifacts:
    - path: "src/models/threat.py"
      provides: "Core v1 threat data model (typed + validated)"
    - path: "tests/test_threat_model.py"
      provides: "Validation coverage for model invariants"
  key_links:
    - from: "src/models/threat.py"
      to: "Phase 2 normalizer"
      via: "shared base fields"
      pattern: "ThreatBase"
---

<objective>
Define the v1 threat data model used across collectors, correlation, and reporting.

Purpose: Make ingestion and storage predictable by standardizing core fields and validation.
Output: Pydantic models for CVE, indicator, campaign + tests.
</objective>

<execution_context>
@/home/ubuntu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement core threat models (CVE, indicator, campaign)</name>
  <files>
src/models/__init__.py
src/models/threat.py
  </files>
  <action>
Create `src/models/threat.py` using Pydantic models.

Minimum shape:
- `ThreatType` enum: `cve`, `indicator`, `campaign`
- `ThreatBase` fields:
  - `id` (string; deterministic when possible: e.g., `"cve:CVE-2025-1234"`, `"otx:indicator:1.2.3.4"`)
  - `source` (string; e.g., `nvd`, `otx`, `rss`)
  - `type` (ThreatType)
  - `title` (string), `description` (string, optional)
  - `published_at` (datetime, optional), `observed_at` (datetime, optional)
  - `severity` (float 0..10 optional)
  - `references` (list[str])
  - `tags` (list[str])
  - `raw` (dict; original payload fragment)

Then add:
- `CVEThreat(ThreatBase)`: `cve_id`, `cvss_vector` (optional), `cwe` (optional list)
- `IndicatorThreat(ThreatBase)`: `indicator`, `indicator_type` (domain/ip/url/hash/email)
- `CampaignThreat(ThreatBase)`: `campaign` (name/id), `aliases` (list[str])

Keep the model strict on required identity fields (id/source/type/title) but tolerant on optional fields to avoid ingestion brittleness.
  </action>
  <verify>python3 -c "from models.threat import CVEThreat; CVEThreat.model_json_schema()"</verify>
  <done>Models import and produce JSON schema without errors</done>
</task>

<task type="auto">
  <name>Task 2: Add tests for invariants and parsing edge cases</name>
  <files>tests/test_threat_model.py</files>
  <action>
Add `tests/test_threat_model.py`:
- Valid objects for each model type
- Reject invalid severity (<0 or >10)
- Ensure `id` formats are stable (simple string prefix checks)
- Ensure `references` defaults to [] and remains list[str]
  </action>
  <verify>python3 -m pytest -q</verify>
  <done>Threat model tests pass</done>
</task>

</tasks>

<verification>
- `python3 -m pytest -q` passes
</verification>

<success_criteria>
- A collector can produce a `ThreatBase`-compatible object without ambiguity about required fields
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
